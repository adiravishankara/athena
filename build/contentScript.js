console.log("Content script loaded");window.athenaContentScriptLoaded=!0;chrome.storage.local.get(["researchMode"],function(e){(e.researchMode||!1)&&l()});chrome.storage.onChanged.addListener(function(e,t){t==="local"&&e.researchMode&&(e.researchMode.newValue?l():c())});chrome.runtime.onMessage.addListener(function(e,t,n){return console.log("Content script received message:",e),e.action==="RESEARCH_MODE_CHANGED"&&(e.isEnabled?l():c(),n&&n({status:"success"})),!0});function l(){if(document.getElementById("athena-floating-button"))return;const e=document.createElement("div");e.id="athena-floating-button",e.innerHTML="+",e.style.position="fixed",e.style.top="50%",e.style.right="20px",e.style.transform="translateY(-50%)",e.style.background="#004d40",e.style.color="white",e.style.padding="18px 22px",e.style.borderRadius="50%",e.style.fontSize="30px",e.style.fontWeight="bold",e.style.cursor="pointer",e.style.zIndex="10000",e.style.boxShadow="0 3px 8px rgba(0,0,0,0.4)",e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.style.width="50px",e.style.height="50px";let t=!1,n,r;e.addEventListener("mousedown",function(o){t=!0,n=o.clientX-e.getBoundingClientRect().left,r=o.clientY-e.getBoundingClientRect().top}),document.addEventListener("mousemove",function(o){if(t){const s=o.clientX-n,i=o.clientY-r;e.style.right="auto",e.style.bottom="auto",e.style.transform="none",e.style.left=s+"px",e.style.top=i+"px"}}),document.addEventListener("mouseup",function(){t=!1}),e.addEventListener("click",function(o){if(!t){const s=window.location.href,i=document.title;chrome.runtime.sendMessage({action:"CHECK_URL_EXISTS",url:s},a=>{if(a&&a.exists)e.innerHTML="✓",e.style.background="#2e7d32",e.style.pointerEvents="none";else{chrome.runtime.sendMessage({action:"ADD_SOURCE",url:s,title:i,type:"web",datetime:new Date().toISOString()});const d=e.style.background;e.style.background="#2e7d32",e.innerHTML="✓",setTimeout(()=>{e.style.background=d,e.innerHTML="+"},1e3)}})}}),document.body.appendChild(e)}function c(){const e=document.getElementById("athena-floating-button");e&&e.remove()}
